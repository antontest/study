# 面试总结

## 怎么理解“Linux中一切皆文件”？

在linux系统中，对所有文件（目录、字符设备、块设备、套接字、打印机等）操作，读写
操作都可以用open()/close()/fwrite()/fread()等函数进行处理。屏蔽了对硬件的区别。
所有设备都抽象成文件，提供统一的接口给用户。

# linux中进程间通信

|方法|说明|
|----|----|
|管道|（1）管道是一种**半双工**的通信方式，数据只能单向流动。<br> （2）**只能在具有亲缘关系的进程间使用**。<br> （3）进程的亲缘关系通常是指父子进程关系。|
|有名管道|有名管道也是**半双工**的通信方式，但是它**允许无亲缘关系进程间的通信**。|
|信号量|（1）信号量是一个计数器，可以用来控制多个进程对共享资源的访问。<br> （2）它通常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。<br>（3）主要作为进程间以及同一进程内不同线程之间的同步手段。|
|消息队列|（1）消息队列是有消息的链接，存放在内核中并由消息队列标识符标识。<br> （2）消息队列克服了**信号传递信息少**、**管道只能承载无格式字节流以及缓冲区大小受限制**等缺点。|
|信号|信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。|
|共享内存|（1）共享内存就是映射一段能被其他进程所能访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。<br>（2）共享内存是最快的IPC方式，它是针对其他进程间通信方式运行效率低而专门设计的。<br>（3）它往往与其他通信机制，如**信号量**，配合使用**来实现进程间的同步和通信**。|
|套接字|套接字也是一种进程间的通信机制，与其他机制不同的是，它可用于不同PC之间的进程通信。|

# linux中进程和线程的区别

**进程**：资源分配的最小单位。  
**线程**：程序执行的最小单位。  

**进程**：程序执行时的一个实例，是系统资源（CPU时间、内存等）的基本单位。  
**线程**：线程是进程的一个执行流，是CPU调度和分派的基本单位。它是比进程更小的能
独立运行的基本单位。  

**进程**有独立的地址空间，**线程**没有单独的地址空间。  

# 信号量、互斥锁、读写锁和条件变量的区别

|方法|说明|
|----|----|
|信号量|（1）信号量强调的是线程或进程的同步。<br>（2）信号量用在多线程多任务同步的。<br>（3）一个线程完成了某一动作就通过信号量告诉别的线程，别的线程再执行某些动作。<br>（4）当信号量为单值信号量时，也可以完成对一个资源的互斥访问。<br>（5）信号量不一定是锁定某一个资源，而是流程上的概念。|
|互斥锁|互斥锁强调的是对资源的互斥访问，即统一时刻只能有一个线程对某一资源进行访问。|
|读写锁|（1）一次只有一个线程可以占有写模式的读写锁，但是多个进程可以同时占有读模式的读写锁。<br>（2）读写锁非常适合于对数据结构的次数大于写的情况。|
|条件变量|条件变量与互斥锁一起使用时，允许线程以无竞争的方式等待特定的条件发生。条件本身是由互斥量保护的。|

# fork出的子进程和父进程的继承关系

fork出来的子进程，基本上除了进程号之外父进程的所有东西都有一份拷贝。  
由子进程自父进程继承到的资源有：  

- 环境
- 堆栈
- 内存
- 打开文件的描述符
- nice值
- 进程组号
- 当前工作目录
- 跟目录
- 控制终端

# dhcp自动获取ip地址流程

DHCP服务器以udp 67端口号进程数据传输，DHCP客户端以udp 68端口号进行数据传输。  
在整个DHCP服务器为DHCP客户端初次提供IP地址自动分配过程中，一共经历了以下四个阶段
：

1. 发现阶段
  > DHCP客户端在网络中广播发送DHCP DISCOVER请求报文，发现DHCP服务器，请求IP地址
  租约。

2. 提供阶段
  > DHCP服务器通过DHCP OFFER报文向DHCP客户端提供IP地址预分配。

3. 选择阶段
  > DHCP客户端通过DHCP REQUEST报文确认选择第一个DHCP服务器为它提供IP地址自动分配服务。

4. 确认阶段
  > 被选择的DHCP服务器通过DHCP ACK报文把在DHCP OFFER报文中准备的IP地址租约给对应的客户端。

![DHCP客户端从DHCP服务器获取IP地址的四个阶段
](http://img1.51cto.com/attachment/201301/085558781.png)

# IGMP怎么获取的组播MAC地址

组播地址与其对应的组播MAC换算关系如下：  
组播MAC=组播MAC标识+组播IP地址23位对应的二进制位（32位的IP地址取后23位）

# DHCPv6自动获取IP地址流程

1. Solicit
  > DHCPv6客户端发送该消息，请求DHCPv6服务器为其分配IPv6地址/前缀和网络配置参数 。

2. Advertise
  > 如果Solicit消息没有携带rapid commit选项，或者携带了rapid commit选项但服务器不支持快速分配过程，则DHCPv6服务器回复该消息，通知客户端可以为其分配地址/前缀和网络参数等。

3. Request
  > 如果DHCPv6客户端接收到多个服务器回复的Advertise消息，则根据消息接收到的先后顺序、服务器优先级等，选择其中一个服务器，并向该服务器发送Request消息，请求服务器确认为其分配IPv6信息。

4. Reply
  > DHCPv6服务器分配给客户端的IPv6地址/前缀具有一定的租借期限。租借期限又有效生命期决定。地址/前缀的租借时间到达有效生命期后，DHCPv6客户端不能再使用该地址。

# select和epoll的区别

1. epoll 不同每次调用都向内核拷贝事件描述信息。在第一次调用后，事件就会与对应的
   epoll描述符关联起来。

2. 另外，epoll不是通过轮询，而是通过在等待的描述符上注册回调函数。当事件发生时，
   回调函数负责把发生的事件存储在就绪事件链表中，最后写到用户空间。

# PPPoE

PPPoE即以太网上的点对点协议，它可以使以太网上的主机通过一个简单接入设备连到
Internet上，并对连入的用户进行控制、计费管理。  
PPPoE拨号连接包括Discovery(发现)和Session(PPP会话)两个阶段。  

Discovery阶段：  
1. PADI
  > 如果要建立一条PPPoE连接，首先PPPoE客户端要以广播的方式发送一个PADI数据包，包中包括客户端请求的服务。

2. PADO
  > 当PPPoE服务器收到PADI包之后，它会判断自己是否能够提供服务，如果能够提供服务的话，就会向客户端发送PADO数据包进行回应。该包包括PPPoE服务器名称和PADI数据包中相同的服务名。如果PPPoE服务器不能为PADI提供服务，则不允许用PADO数据包进行回应。

3. PADR
  > 由于PADI是以广播的形式发送出去的，PPPoE客户端可能不止接收到一个PADO数据包。它将审查所有PADO数据包，并根据其中的服务器名或所提供的服务选择一个PPPoE服务器，并向选中的服务器发送PADR数据包。PADR数据包包括客户端所请求的服务。

4. PADS
  > 当PPPoE服务器收到客户端发送的PADR包时，它就准备开始一个PPPoE会话，为PPPoE会话创建一个唯一的PPPoE会话ID，并向客户端发送PADS包作为响应。

PPP会话阶段：  
1. 当PPPoE进入PPP会话阶段后，客户端和服务器将进行标准的PPP协商，PPP协商通过后，
   数据通过PPP封装发送。PPP报文作为PPPoE帧的净荷被封装在以太网中，发送到PPPoE链
   路的对端。Session ID必须是Discovery阶段确定的，且在会话过程中保持不变，MAC地
   址必须是对端的MAC地址。

# ipsec

## ipsec体系结构

![ipsec体系结构](http://img1.51cto.com/attachment/201102/021222337.jpg)

## 两阶段交换

- 第一阶段：建立起ISAKMP SA —— IKE SA
  双方（例如ISAKMP Sservers）商定如何保护以后的通讯，通信双方建立一个已通过身份鉴别和安全保护的通道；
  此SA将用于保护后表的protocol SA的协商过程。

- 第二阶段：建立起针对其他安全协议的SA —— IPSec SA
  这个阶段可以建立多个SA；
  此SA将被相应的安全协议用于博阿虎数据或者消息的交换。


## IPSec-VPN协议和算法

IP安全协议：AH，ESP
数据加密标准：DES，3DES
公共密钥密码协议：Diffe-Hellman(D-H)
散列算法：MD5，SHA-1
公钥加密算法：RSA
Internet密钥交换：IKE
证书授权中心：CA

# 其他
IKE：Internet Key Exchange，互联网密钥交换协议，由SKEME、Oakley、ISAKMP组成。
所有的IKE交互都是成对（请求和应答）组成的。每一对称为“交换”（Exchange）。  
前面几个建立IKE_SA的报文称其为IKE_SA_INIT Exchange和IKE_AUTH Exchange，随后的是CREATE_CHILD_SA Exchange和INFORMATIONAL Exchange。  
IKE交互总是始于IKE_INIT和IKE_AUTH。

![ipsec抓包流程](http://images.cnitblog.com/blog/494157/201312/30211423-5fdf52fe9cb44b97af9a841614cd06d7.png)