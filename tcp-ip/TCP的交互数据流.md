## TCP的交互数据流
- - -

### 目录


* [交互式输入](#交互式输入)
* [经受时延的确认](#经受时延的确认)
* [Nagle算法](#nagle算法)
	* [关闭Nagle算法](#关闭nagle算法)

* * * 

### 交互式输入 

- 据一份通信量数据研究表明：TCP成块数据量和交互数据量的比例为90%和10%。  
- 对于Rlogin而言，每一个交互按键都会产生一个数据分组。也就是说，每次从客户传到服务器的是一个字节的按键。  

### 经受时延的确认

- 通常，TCP在接收到数据时并不立即发送ACK；相反，它会延迟发送，以便将ACK与沿该方向发送的数据一起发送。这种现象称为数据捎带ACK。  
- 绝大多数系统实现采用的时延为**200ms**。也就是说TCP将以最大200ms的时延等待是否有数据一起发送。  

### Nagle算法
如Rlogin连接中的交互数据，客户一般每次发送一个字节到服务器，这就产生了一些41字节的分组：20字节IP首部，20字节TCP首部和1字节数据。  
在局域网上，这些小分组通常部分引起麻烦，因为局域网一般不会出现拥塞。但在广域网上，这些小分组就会增加拥塞出现的可能。一种简单的方法就是采用Nagle算法。  

Nagle算法要求一个连接上最多只能有一个未被确认的未完成的小分组，在该分组的确认到达之前不能发送其他小分组。  
Nagle算法的优势在于：它是自适应的，确认到达越快，数据也就发送越快。  

#### 关闭Nagle算法 
一些小消息，如鼠标移动等，必须无时延地发送，以便进行某种操作的交互，为用户提供实时的反馈。因此，需要关闭Nagle算法。  
socket API用户可以使用TCP_NODELAY选项来关闭Nagle算法。  
