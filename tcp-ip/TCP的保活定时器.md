## TCP的保活定时器
- - -

### 目录



* * * 

### 描述
一个服务器希望知道客户主机是否崩溃或者崩溃又重新启动时，TCP保活定时器能提供这种能力。  
保活定时器主要是为了**服务器应用程序**提供的, **试图在服务器端检测TCP的半打开状态**。因为，服务器应用程序可能会**代表客户绑定一些资源**，因此希望知道客户主机是否崩溃。  

**保活定时器的缺点**：  

- 在出现短暂差错的情况下，可能会使一个非常好的连接释放掉；
- 耗费不必要的带宽；
- 在按分组计费的情况下增加在互联网上花掉等多钱；

如果一个给定的连接上在**两个小时内**没有任何动作，则服务器就向客户发送一个探查报文段。客户主机必须处于以下4中状态之一：  

- 客户主机依然正常运行，并能从服务器可达。
  > 客户TCP响应正常，服务器也能知道对方正常工作。服务器在两个小时以后将保活定期是复位。如果两小时内有应用程序数据通过此连接，则定时器在交换数据后的未来2小时再复位。  

- 客户主机已经崩溃，并且关闭或者正在启动。
  > 客户主机关闭或者正在启动，客户的TCP都不会应答。服务器不能收到探查响应，并在75秒后超时。服务器总共会发送10个这样的探查，每个间隔**75秒**。如果服务器没有收到一个响应，它就认为客户主机已经关闭并终止该连接。

- 客户主机崩溃并已经重新启动。
  > 这是服务器呢个收到一个对保活探查的响应，但该响应是一个TCP复位响应，使得服务器终止这个连接。

- 客户主机正常运行，但从服务器不可达。
  > 这与状态2相同，因为TCP不能区分状态2和4，它能知道的就是没有收到保活探查的响应。
