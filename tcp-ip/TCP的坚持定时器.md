## TCP的坚持定时器
- - -

### 目录



* * * 

### TCP坚持定时器
TCP并不对一个ACK进行确认，如果一个ACK确认丢失，则双方就可能出现发送方等待允许它发送的窗口更新，而接收方等待接收数据。  
为了防止上述死锁情况发生，发送方使用一种坚持定时器(persist timer)来周期性向接收方查询，以便发现窗口是否已经增大。  
从发送方发出的报文段称之为窗口探查。  

 在连接的一方**需要发送数据但是对方已通告窗口大小为0**，就需要设置TCP的坚持定时器。  
 坚持定时器使用了普通的TCP指数退避。但坚持定时器总是在**5~60秒**之间。  
**窗口探查包含一个字节的数据**。TCP允许发送已关闭窗口之后的一个自己的数据。  
坚持定时器探查过程会持续到窗口被打开，或者应用进程使用的连接被终止。  

### 糊涂窗口综合症 
糊涂窗口综合症(Silly Windown Syndrome, SWS)是在通过窗口流量控制的时候发生的一种在连接双方发送小报文的一些情况。  
这里的**小报文指的是小于MSS长度的报文**，MSS在SYN交互时通过Option选项协商。  

避免出现”糊涂窗口综合症“的现象的措施有：  

- 接收方
  - 不通告小窗口 
    > 接收方不通过比当前窗口大的窗口，除非窗口**可以增加一个报文段大小**，或者**增加接收缓冲区空间的一半**。

- 发送方
  1) 可以发送一个满长度(MSS)的报文段；
  2) 可以发送至少接收方通告窗口大小一半的报文段；
  3) 能发送手头所有的数据并且不希望接收ACK或者该连接禁止了Nagle算法；
