## IGMP: Internet组管理协议
---

### 目录


* * *

### IGMP作用
支持主机和路由器进行多播。**用来在IP主机和与其直接相邻的组播路由器之间建立、维护组播成员关系**。但不包括组播路由器之间的组成员关系信息的传播和维护。  
IGMP报文**通过IP数据报**进行传输。  

### IGMP首部格式

![] [igmp_head]

- 4位版本号：当前为IGMP有3个版本；
- 2位IGMP类型：1说明是由多播路由器发生的查询报文，2说明是主机发出的报告报文。  
- 32位组地址：D类IP地址。查询报文中组地址设置位0；  

### 组播重要内容

- 组成员是动态的，主机可以随时加入或者离开组；
- 主机加入多播组的能力是通过发送IGMP消息执行的；
- 组大小不受限制，且其成员可以分布在多个IP网络中；
- 主机可以向组的IP地址发送IP通讯；  


### IGMP报告和查询
IGMP使用规则如下：  

- 当第一个进程加入一个组时，主机就发送一个IGMP报告。如果一个主机的过个进程加入同一个组，只发送一个IGMP报告。
- 进程离开一个组时，不发送IGMP报告。
- 多播路由器定时发送IGMP查询报文来了解是否还有任何主机包含有属于多播组的进程。
- 主机发送IGMP报告来响应一个IGMP查询。

### IGMP消息
**IGMP用于在支持多播的路由器以及多播组的成员之间交换成员身份状态信息**。多播组的主机成员身份由单独成员主机报告，而成员身份状态由多播路由器定期轮询。   
下表描述了IGMP消息类型。  

|IGMP消息类型|描述|
|------------|----|
|主机报告报文|当主机加入多播组时发送。  响应路由器发送的IGMP身份查询时发送IGMP主机报告信息。|
|多播路由器查询报文|多播路由器使用查询报文定期轮询以了解组成员状态|

#### 实现细节

- 当一个主机首次发送一个IGMP报文时，并不保证被可靠接收。下一个报告将在间隔一段时间后发送，这个时间一般为**0~10s**之间的随机数。  
- 当一个主机收到一个IGMP查询报文后，并不马上响应，而是经过一段时间间隔后才响应。这是因为，在一个物理网络中的所有主机将接收到同组其他成员发送的所有报告。这就以为着，在等待发送报告的过程中，如果收到了其他主机相同的报告，那么该主机就不用发送相同响应了。  
- 多播路由器并不关系有多少个主机属于该多播组，而只关心该组是否还有至少还拥有一个主机。  

#### 生存时间
IGMP报告和查询报文的生存时间TTL均被设为1。  
从224.0.0.0到224.0.0.255的特殊地址空间是打算用于多播范围不超过1跳的应用。不管TTL是多少，多播路由器均不转发目的地址位这些地址的数据报。  

#### 所有主机组
224.0.0.1被称为所有主机组地址。它涉及在一个物理网络中的所有具备多播能力的主机和路由器。  
当接口被初始化后，所有具备多播能力接口上的主机均自动加入这个多播组。这个组的成员无需发送IGMP报告。  

[igmp_head]: http://7xqyee.com1.z0.glb.clouddn.com/IGMP.png "IGMP报文首部格式"
