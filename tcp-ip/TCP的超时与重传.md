## TCP的超时与重传  
- - - 

### 目录  



- - -

### TCP管理的4个定时器

- 重传定时器
  > 希望收到另一端的确认；

- 坚持定时器
  > 使滑动窗口大小信息保持不断流动；

- 保活定时器
  > 检测一个空闲连接的另一端何时崩溃或重启；

- 2MSL定时器
  > 测量一个连接处于TIME_WAIT状态的时间；

### 往返时间测量
TCP超时与重传中最重要的部分就是**对一个给定的连接的往返时间(RTT)的测量**。  
由于路由器和网络流量均会发生变化，因此这个时间可能经常会随之发生变化。TCP应该跟踪这些变化并相应地改变其超时时间。  
在RTT变化范围较小时，采用被平滑的RTT估计器。当RTT变化范围很大时，采用基于均值和方差来计算RTO。  

#### Karn算法
当一个超时和重传发生时，在重传数据的确认最后到达时，不能更新RTT估计器。

#### 往返时间RTT的测量
大多数源于伯克利的TCP实现，在任何时候对每个连接**仅测量一次RTT值**。

### 拥塞避免算法
拥塞避免算法是一种处理丢失分组的方法。  
拥塞避免算法和慢启动算法需要对每个连接维持两个变量：**一个拥塞窗口cwnd** 和 **一个慢启动门限ssthresh**。  
两个算法的工作流程如下：

- 对一个给定的连接，初始化cwnd为一个报文段，ssthresh为65535个字节；  
- 当拥塞发生时（超时或者收到重复确认），ssthresh被设置为当前窗口大小的一半。此外，如果是超时引起的拥塞，则cwnd被设置为1个报文段；  
- 当新的数据被对方确认时，就增加cwnd。但增加的方法依赖于是否正在进行慢启动或者拥塞避免。如果cwnd小于或等于ssthresh，则正在进行慢启动，否则正在进行拥塞避免。如果是慢启动，则没收到一个ACK，cwnd就加1。如果是拥塞避免，每收到一个ACK就将cwnd增加1/cwnd。

#### 快速重传和快速恢复算法
如果一连串收到3个或3个以上的重复ACK，就非常可能是一个报文段丢失了。于是，此时就重传丢失的数据报文段，而无需等待超时定时器溢出，这就是快速重传算法。接下来执行的不是慢启动算法而是拥塞避免算法，这就是快速恢复算法。  
