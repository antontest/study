## TCP -- 传输控制协议

### 目录

* [简介](#简介)
* [TCP提供的服务](#tcp提供的服务)
* [TCP首部](#tcp首部)

### 简介
&emsp; TCP提供一种面向连接的、可靠的**字节流**服务。

### TCP提供的服务
&emsp; TCP的可靠性保障主要由以下方面提供给:

- 应用数据被分割成TCP认为最合适的大小；
- 发送一个数据包后启动一个定时器；
- 另一端对收到的数据进行确认（确认不立即发送，一般推迟几分之一秒）；
- 对失序的数据重新排序，丢弃重复的数据；
- 提供端到端的流量控制；
- 校验和覆盖TCP首部和TCP数据；

### TCP首部
![TCP首部] [TCP-Header]

&emsp; TCP首部最小20字节，最大60字节：

- 16位源端口号
- 16位目的端口号

  > 两个端口号用于寻找发送端和接收端应用程序，再加上两端IP地址唯一确认一个TCP连接

- 32位序号

  > 表示报文段中第一个数据字节的序号；

- 32位确认号

  > 确认号=接收端序号+数据长度；

- 4位首部长度

  > 由于TCP有可选的选项，因此该值是可变的(UDP首部长度只能是8字节)。

- 6位保留位
- 6位标志位
  - URG

    > 紧急指针时有效；

  - ACK

    > 确认序号有效;
    > TCP接收到数据段后并不立即发送确认包，而且延迟一段时间（一般几分之一秒）等待是否有需要发送的数据，和其一起发送

  - PSH

    > 发送方通知接收方接收所有TCP数据（包括当前数据和之前TCP接收的数据）；
    > 当前大多数TCP实现并不提供设置PSH位的接口；

  - RST

    > 重建连接；

  - SYN

    > 同步序列号；
    > 在TCP三次握手中前两次握手中使用；

  - FIN

    > 发送端完成发送任务；
    > 在关闭TCP连接时使用；
    
- 16位窗口大小

  > 接收端接收窗口大小

- 16位校验和

  > 校验和覆盖TCP首部和TCP数据；
  > 是一个端对端校验，由发送端计算，接收端验证；

- 16位紧急指针
- 选项（可选）

[TCP-Header]: http://www.myexception.cn/img/2014/12/12/110828258.png "TCP首部"
