## TCP的未来与性能
- - -

### 目录



### 引言
**路径MTU**发现机制可以使TCP为非本地的连接使用大于536(TCP连接目的IP为非本地时，MSS的通常值即为536)字节的MTU，从而增加TCP吞吐量。  
**长肥管道**就是具有很大的带宽时延乘积的网络。为了处理长肥管道，需要使用TCP的两个新选项：**窗口扩大选项**（用来增加TCP的最大窗口）以及**时间戳选项**（使TCO对报文段进行更精准的RTT测量，也可以在高速环境下对可能发生的序号回绕提供保护）。  

### 路径MTU发现 
**路径MTU**：是当前两台主机之间的路径上任何网络的最小MTU。  
如果一个待转发的IP数据报被设置了DF标志，而其长度又超过了MTU，那么路由器将返回ICMP不可达错误。  

TCP的路径MTU发现步骤：  

- 根据自身及对方声明的MSS确认起始的报文段大小
  > 初始段大小不允许大于对端声明的MSS；  
  > 如果对端没有声明MSS，则使用默认值536；  

- 将IP数据报首部中的DF标志位置为1
- 如果接收ICMP错误信息告知需要分片，TCP就减少段大小并进行重传
  > 如果包含下一跳MTU信息，则设置为该MTU减去IP和TCP首部长度；  
  > 如过没有包含下一跳MTU信息，则调整数据的最大容量至下一个可能的大小；  

- DF标志位会一直打开，以保证能够测量得到正确的路径MTU
- 超时后，拥塞窗口不需要改变，但要启动慢启动。然后重新探查路径MTU，以保证链路改变也能用到正确的路径MTU

TCP路径MTU探查的好处：  

- 可以避免在通过MTU小于576的中间链路时进行分片
- 防止中间链路的某些网络的MTU小于通信两端所在网络的MTU时进行分片；
- 充分利用链路的吞吐量；
  > 报文小了，则影响数据传输效率；大了，则会引起数据分片，进而导致中间路由器的负担加重，增加延迟，也会增加报文丢失的概率；

### 长肥管道
把一个连接的容量表示为*capacity(b)=bandwidth(b/s) × round-trip time(s)*称之为**带宽时延乘积**。  
具有大的带宽时延乘积的网络称为**长肥网络**。而运行在一个长肥网络上的TCP连接称为**长肥管道**。  

长肥管道在实际中会遇到多种问题：  

- TCP首部窗口大小为16位，从而将窗口限制在65535字节内。
- 一个长肥网络内的分组丢失会使吞吐量急剧减少。
- 许多TCP实现对**每个窗口**的RTT仅进行一次测量。

### 窗口扩大选项
通过定义一个选项实现对一个16bit的扩大操作来完成窗口扩大。  
为了使用窗口扩大，两端必须在他们的SYN段中发送该选项。  

### 时间戳选项
时间戳选项使发送方在每个报文段中放置一个时间戳值。接收方在确认中返回这个数值，从而允许发送方为每个收到的ACK计算RTT值。
